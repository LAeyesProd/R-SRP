# SLSA Configuration for R-SRP Ultra
# Implements Supply-chain Levels for Software Artifacts

version: 1.0.0

# Build Configuration
build:
  # Build on GitHub Actions
  builder:
    id: "https://github.com/slsa-framework/slsa-github-generator/.github/workflows/generator@v1"
  
  # Build platform
  platform:
    type: github_actions
    repository: ${{ github.repository }}
    ref: ${{ github.ref }}
    sha: ${{ github.sha }}
  
  # Build invocation
  invocation:
    configSource:
      uri: "git+https://github.com/${{ github.repository }}@${{ github.ref }}"
      digest:
        sha1: ${{ github.sha }}
      entryPoint: ".github/workflows/defense-ci.yml"
  
  # Build materials (dependencies)
  materials:
    - uri: "git+https://github.com/rust-lang/cargo@main"
      digest:
        sha256: "<cargo-commit-sha>"
    - uri: "https://crates.io"
      digest:
        sha256: "<crates-io-commit-sha>"

# Source Level (SLSA 1)
source:
  level: 3  # Verifiable
  requirements:
    - Every change to the source is recorded in a version control system
    - The version control system has a mechanism to identify the source
    - The build is triggered by a change to the source
    - The provenance is automatically generated

# Build Level (SLSA 3)
build:
  level: 3  # Hardened
  requirements:
    - Build runs on a hardened runner
    - Build steps are defined in a configuration file
    - All build steps are executed serially
    - Build environment is captured in provenance
    - Provenance is generated by the build platform

# Provenance Requirements
provenance:
  level: 2  # Hosted
  format: in-toto
  predicateType: https://slsa.dev/provenance/v0.2
  contents:
    - buildDefinition
    - runDetails
  verification:
    - identity
    - content
    - timestamp

# Dependencies (SLSA 3)
dependencies:
  level: 3  # Hardened
  requirements:
    - All dependencies are resolved via package manager
    - Dependencies are locked to specific versions
    - Dependency SBOM is generated
    - Vulnerability scanning is performed

# Binary Hardening
binary:
  pie: true
  relro: full
  stack_canary: true
  nx: true
  fortify: true
  crc_check: true

# Distribution
distribution:
  signed: true
  verified: true
  attestation:
    - cosign
    - gpg
    - slsa

# Security Levels
security:
  # Target SLSA Level
  target_level: 3
  
  # Current achieved level
  current_level: 3
  
  # Security measures
  measures:
    - code_review
    - automated_tests
    - security_audit
    - vulnerability_scanning
    - provenance_generation
    - signed_releases
