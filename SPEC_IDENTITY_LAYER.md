# ğŸ” SpÃ©cification: Zero-Trust Identity Layer

## 1. Vue d'Ensemble

Cette spÃ©cification dÃ©taille l'implÃ©mentation de la couche d'identitÃ© Zero-Trust pour le Registre National des Comptes Bancaires. L'objectif est de garantir que **zÃ©ro accÃ¨s n'est accordÃ© sur la seule base d'un login/mot de passe**.

---

## 2. Principes Fondamentaux

### 2.1 RÃ¨gles d'Or

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PRINCIPES ZERO-TRUST IDENTITÃ‰                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  RÃˆGLE #1: JAMAIS SEULELEMENT CREDENTIALS                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                             â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚     â”‚   Login     â”‚    +    â”‚   Password  â”‚    +    â”‚     MFA     â”‚       â”‚
â”‚     â”‚   (requis)  â”‚         â”‚   (requis)  â”‚         â”‚  (OBLIGAT.) â”‚       â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚           âœ“                      âœ“                      âœ“                  â”‚
â”‚           â”‚                      â”‚                      â”‚                  â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                  â–¼                                           â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                          â”‚  ACCÃˆS      â”‚                                    â”‚
â”‚                          â”‚  AUTORISÃ‰   â”‚                                    â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                                                                             â”‚
â”‚  RÃˆGLE #2: DEVICE BINDING OBLIGATOIRE                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                             â”‚
â”‚     Utilisateur â”€â”€â–¶ Appareil enregistrÃ© â”€â”€â–¶ Certificat binds                â”‚
â”‚                          â”‚                                                   â”‚
â”‚                          â–¼                                                   â”‚
â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚                 â”‚ Attestation     â”‚                                         â”‚
â”‚                 â”‚ FIDO2 validÃ©e  â”‚                                         â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                                                                             â”‚
â”‚  RÃˆGLE #3: CONTEXTE DYNAMIQUE                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                             â”‚
â”‚     AccÃ¨s = f(IP, GÃ©oloc, Horaire, Device, Comportement)                  â”‚
â”‚                                                                             â”‚
â”‚  RÃˆGLE #4: MISSION ACTIVE                                                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                             â”‚
â”‚     Tout accÃ¨s doit Ãªtre validÃ© contre une mission active                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Flux d'Authentification DÃ©taillÃ©

### 3.1 SÃ©quence d'Authentification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SEQUENCE AUTHENTIFICATION COMPLETE                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ACTOR          IDP                  CRUE              API GATEWAY       â”‚
â”‚  â”€â”€â”€â”€â”€          â”€â”€â”€                  â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”                                                                      â”‚
â”‚  â”‚User  â”‚                                                                       â”‚
â”‚  â”‚Agent â”‚                                                                       â”‚
â”‚  â””â”€â”€â”¬â”€â”€â”€â”˜                                                                       â”‚
â”‚     â”‚ 1. Login + Password                                                     â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                                    â”‚
â”‚     â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚                                    â”‚ Validation credentials       â”‚  â”‚
â”‚     â”‚                                    â”‚ - Login existe                â”‚  â”‚
â”‚     â”‚                                    â”‚ - Password OK                â”‚  â”‚
â”‚     â”‚                                    â”‚ - Compte actif               â”‚  â”‚
â”‚     â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚     â”‚                                                     â”‚                  â”‚
â”‚     â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚                                    â”‚ Challenge MFA                â”‚  â”‚
â”‚     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ FIDO2/WebAuthn              â”‚  â”‚
â”‚     â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚     â”‚                                                                          â”‚
â”‚     â”‚ 2. Authentification FIDO2                                               â”‚
â”‚     â”‚    - Touch / PIN YubiKey                                                â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                                    â”‚
â”‚     â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚                                    â”‚ VÃ©rification Device           â”‚  â”‚
â”‚     â”‚                                    â”‚ - Attestation certificate     â”‚  â”‚
â”‚     â”‚                                    â”‚ - Device fingerprint          â”‚  â”‚
â”‚     â”‚                                    â”‚ - Non rÃ©voquÃ©                â”‚  â”‚
â”‚     â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚     â”‚                                                     â”‚                  â”‚
â”‚     â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚                                    â”‚ VÃ©rification contexte         â”‚  â”‚
â”‚     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ - IP whitelist/blacklist    â”‚  â”‚
â”‚     â”‚                                    â”‚ - GÃ©olocation cohÃ©rente      â”‚  â”‚
â”‚     â”‚                                    â”‚ - Horaire mission            â”‚  â”‚
â”‚     â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚     â”‚                                                     â”‚                  â”‚
â”‚     â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚                                    â”‚ VÃ©rification mission active   â”‚  â”‚
â”‚     â”‚                                    â”‚ - Mission ID valide           â”‚  â”‚
â”‚     â”‚                                    â”‚ - PÃ©rimÃ¨tre OK               â”‚  â”‚
â”‚     â”‚                                    â”‚ - Pas expirÃ©e                â”‚  â”‚
â”‚     â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚     â”‚                                                     â”‚                  â”‚
â”‚     â”‚                                                     â–¼                  â”‚
â”‚     â”‚ 3. TOKEN JWT                                                          â”‚
â”‚     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (Si toutes validations OK)        â”‚
â”‚     â”‚  {                                                                       â”‚
â”‚     â”‚    "sub": "AGENT_4571",                                              â”‚
â”‚     â”‚    "org": "GENDARMERIE_NATIONALE",                                   â”‚
â”‚     â”‚    "mission": "MIS_2026_0234",                                       â”‚
â”‚     â”‚    "scope": ["REGION_75", "REGION_92"],                              â”‚
â”‚     â”‚    "iat": 1736687400,                                                â”‚
â”‚     â”‚    "exp": 1736691000,                                                â”‚
â”‚     â”‚    "amr": ["pwd", "fido2", "hwk"]                                    â”‚
â”‚     â”‚  }                                                                     â”‚
â”‚     â”‚                                                                          â”‚
â”‚     â”‚ 4. RequÃªte API + JWT                                                  â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                        â”‚
â”‚     â”‚                                                      â”‚                 â”‚
â”‚     â”‚                                                      â–¼                 â”‚
â”‚     â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚                                    â”‚ Validation JWT                 â”‚  â”‚
â”‚     â”‚                                    â”‚ - Signature                   â”‚  â”‚
â”‚     â”‚                                    â”‚ - Expiration                  â”‚  â”‚
â”‚     â”‚                                    â”‚ - Claims                      â”‚  â”‚
â”‚     â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚     â”‚                                                     â”‚                  â”‚
â”‚     â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚                                    â”‚ CRUE - VÃ©rification rÃ¨gles   â”‚  â”‚
â”‚     â”‚                                    â”‚ - Volume/Horre                â”‚  â”‚
â”‚     â”‚                                    â”‚ - PÃ©rimÃ¨tre                  â”‚  â”‚
â”‚     â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚     â”‚                                                     â”‚                  â”‚
â”‚     â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚                                    â”‚ DÃ©cision: ACCEPTER/BLOCK      â”‚  â”‚
â”‚     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (Response)                      â”‚
â”‚     â”‚                                                                          â”‚
â”‚     â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Algorithme de DÃ©cision

```python
def authenticate(username, password, mfa_response, device_info, request_context):
    
    # Ã‰TAPE 1: Validation credentials
    user = validate_credentials(username, password)
    if not user:
        log_failure("INVALID_CREDENTIALS", username)
        return Decision.REJECT, "Identifiants invalides"
    
    # Ã‰TAPE 2: VÃ©rification MFA
    mfa_valid = verify_mfa(user, mfa_response)
    if not mfa_valid:
        log_failure("MFA_FAILED", username)
        notify_security_team(username, "Ã‰chec MFA")
        return Decision.REJECT, "Authentification multi-facteurs requise"
    
    # Ã‰TAPE 3: VÃ©rification device binding
    device_valid = verify_device_binding(user, device_info)
    if not device_valid:
        log_failure("DEVICE_NOT_BINDED", username)
        quarantine_user(username)
        return Decision.REJECT, "Appareil non enregistrÃ©"
    
    # Ã‰TAPE 4: Validation contexte
    context_valid = validate_context(user, request_context)
    if not context_valid:
        log_warning("CONTEXT_ANOMALY", username, request_context)
        # Niveau de risque Ã©levÃ© - requires revalidation
        require_additional_verification(username)
    
    # Ã‰TAPE 5: VÃ©rification mission active
    mission_valid = verify_active_mission(user, request_context.mission_id)
    if not mission_valid:
        log_failure("NO_ACTIVE_MISSION", username)
        return Decision.REJECT, "Aucune mission active"
    
    # TOUTES LES VALIDATIONS OK
    token = generate_jwt(user, request_context.mission_id)
    log_success("AUTH_SUCCESS", username)
    
    return Decision.ACCEPT, token
```

---

## 4. Configuration FIDO2

### 4.1 Enregistrement Appareil

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ENREGISTREMENT DISPOSITIF FIDO2                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  1. DEMANDE D'ENREGISTREMENT                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Client (Navigateur)          Serveur (Keycloak)                    â”‚   â”‚
â”‚  â”‚        â”‚                              â”‚                              â”‚   â”‚
â”‚  â”‚        â”‚â”€â”€â”€ POST /fido2/register â”€â”€â”€â–¶â”‚                              â”‚   â”‚
â”‚  â”‚        â”‚                              â”‚                              â”‚   â”‚
â”‚  â”‚        â”‚â—€â”€â”€ Challenge (Base64) â”€â”€â”€â”€â”€â”€â”‚                              â”‚   â”‚
â”‚  â”‚        â”‚                              â”‚                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  2. CRÃ‰ATION CREDENTIAL                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Client (YubiKey)                                                    â”‚   â”‚
â”‚  â”‚        â”‚                                                             â”‚   â”‚
â”‚  â”‚        â”‚ Utilisateur prÃ©sente YubiKey + PIN                        â”‚   â”‚
â”‚  â”‚        â”‚                                                             â”‚   â”‚
â”‚  â”‚        â”‚ GÃ©nÃ¨re:                                                    â”‚   â”‚
â”‚  â”‚        â”‚ - credentialId (identifiant unique)                       â”‚   â”‚
â”‚  â”‚        â”‚ - credentialPublicKey (clÃ© publique)                       â”‚   â”‚
â”‚  â”‚        â”‚ - attestationObject (certificat + signature)             â”‚   â”‚
â”‚  â”‚        â”‚                                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  3. VALIDATION SERVER                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Serveur:                                                             â”‚   â”‚
â”‚  â”‚   - VÃ©rifier attestation (certificat manufacturier)                â”‚   â”‚
â”‚  â”‚   - Valider signature                                               â”‚   â”‚
â”‚  â”‚   - Stocker: credentialId + credentialPublicKey + device_info     â”‚   â”‚
â”‚  â”‚   - GÃ©nÃ©rer device_fingerprint (SHA-256)                          â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  4. STOCKAGE SÃ‰CURISÃ‰                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Table: device_bindings                                               â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚ â”‚ Column           â”‚ Type          â”‚ Description               â”‚  â”‚   â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚   â”‚
â”‚  â”‚ â”‚ user_id          â”‚ UUID          â”‚ RÃ©fÃ©rence utilisateur     â”‚  â”‚   â”‚
â”‚  â”‚ â”‚ credential_id    â”‚ BYTEA         â”‚ Identifiant credential    â”‚  â”‚   â”‚
â”‚  â”‚ â”‚ public_key       â”‚ BYTEA         â”‚ ClÃ© publique (stockÃ©e)   â”‚  â”‚   â”‚
â”‚  â”‚ â”‚ device_fp       â”‚ VARCHAR(64)   â”‚ Fingerprint device        â”‚  â”‚   â”‚
â”‚  â”‚ â”‚ attestation_cert â”‚ VARCHAR       â”‚ Certificat attestation    â”‚  â”‚   â”‚
â”‚  â”‚ â”‚ created_at      â”‚ TIMESTAMP     â”‚ Date crÃ©ation             â”‚  â”‚   â”‚
â”‚  â”‚ â”‚ revoked_at      â”‚ TIMESTAMP     â”‚ Date rÃ©vocation (NULL)   â”‚  â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚ Chiffrement: AES-256-GCM Ã  repos                                   â”‚   â”‚
â”‚  â”‚ AccÃ¨s: restreint (PAM)                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Configuration Keycloak

```yaml
# keycloak-fido2-config.yaml
realm:
  name: rnbc-secure
  
fido2:
  settings:
    # Force attestation pour tous les devices
    attestation: required
    
    # Accept only FIDO2 certified authenticators
    acceptedOrigins:
      - "https://rnbc.fiscalite.gouv.fr"
      - "https://rnbc.justice.gouv.fr"
      
    # User verification required (PIN/Biometrics)
    userVerification: required
    
    # Resident key (å…è®¸å¤šè®¾å¤‡)
    residentKey: preferred
    
  policy:
    # Maximum devices per user
    maxDevicesPerUser: 3
    
    # Require unique attestation
    uniqueAttestation: true
    
    # Reject unknown attestation formats
    acceptUntrustedAttestations: false
```

---

## 5. Validation Contextuelle

### 5.1 RÃ¨gles de Validation

| ParamÃ¨tre | RÃ¨gle | Action si Ã‰chec |
|-----------|-------|-----------------|
| **Adresse IP** | Doit Ãªtre dans whitelist OU anomalie score < seuil | Challenge additionnel |
| **GÃ©olocation** | Doit correspondre Ã  zone de mission | Blocage + Alerte |
| **Horaire** | Doit Ãªtre dans plage horaire mission | Blocage |
| **Device** | Doit Ãªtre liÃ© + non rÃ©voquÃ© | Blocage + Quarantaine |
| **Score anomalie** | Doit Ãªtre < 70/100 | Revalidation MFA |

### 5.2 DÃ©tection d'Anomalie Contextuelle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VALIDATION CONTEXTUELLE - DÃ‰TAIL                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  SCORE DE RISQUE: 0 (faible) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 100 (critique)                    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  IP ADDRESS                                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ +0   IP dans whitelist organisation                          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ +10  IP dans range connu (bureau)                           â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ +30  IP VPN organisation (acceptable)                        â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ +50  IP changement rÃ©cent (derniÃ¨re semaine)                â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ +70  IP pays diffÃ©rent de l'utilisateur                      â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ +90  IP dans blacklist (proxy/TOR)                           â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  GEOLOCATION                                                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ +0   MÃªme ville que d'habitude                               â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ +20  MÃªme rÃ©gion que d'habitude                              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ +40  MÃªme pays que d'habitude                                â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ +60  Changement ville (voyage?)                              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ +80  Changement pays (hors EU)                               â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ +90  Pays Ã  risque                                            â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  TEMPORALITÃ‰                                                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ +0   Dans horaires mission                                   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ +20  Extension horaire (< 2h)                               â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ +50  Hors horaires mission                                   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ +70  Week-end / holidays                                     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ +90  Heure inhabituelle (3am-5am)                            â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  DÃ‰CISION                                                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ Score 0-30:    ACCÃˆS DIRECT                                 â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ Score 31-60:   ACCÃˆS + ALERTE SUPERVISEUR                   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ Score 61-80:   ACCÃˆS + REVALIDATION MFA                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ Score 81-100:  REFUS + ALERTE SOC                           â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Validation Mission Active

### 6.1 Workflow de Mission

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VALIDATION MISSION ACTIVE                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    FLUX CRÃ‰ATION MISSION                             â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚   â”‚
â”‚  â”‚  â”‚ Demandeur â”‚ â”€â”€â”€â–¶ â”‚ Validateurâ”‚ â”€â”€â”€â–¶ â”‚  SystÃ¨me â”‚                   â”‚   â”‚
â”‚  â”‚  â”‚ (Agent)   â”‚      â”‚ HiÃ©rarchie â”‚      â”‚   (BDD)  â”‚                   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚   â”‚
â”‚  â”‚       â”‚                 â”‚                 â”‚                          â”‚   â”‚
â”‚  â”‚       â”‚ Soumission      â”‚ Validation      â”‚                          â”‚   â”‚
â”‚  â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶   â”‚                          â”‚   â”‚
â”‚  â”‚       â”‚                   â”‚                 â”‚                          â”‚   â”‚
â”‚  â”‚       â”‚                   â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚   â”‚
â”‚  â”‚       â”‚                   â”‚                 â”‚                          â”‚   â”‚
â”‚  â”‚       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                         â”‚   â”‚
â”‚  â”‚       â”‚ Notification      â”‚                                         â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  ATTRIBUTS MISSION                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  {                                                                     â”‚   â”‚
â”‚  â”‚    "mission_id": "MIS_2026_0234",                                  â”‚   â”‚
â”‚  â”‚    "type": "ENQUETE_JUDICIAIRE",                                    â”‚   â”‚
â”‚  â”‚    "organisme": "GENDARMERIE_NATIONALE",                            â”‚   â”‚
â”‚  â”‚    "agent_responsable": "AGENT_4571",                               â”‚   â”‚
â”‚  â”‚    "date_debut": "2026-02-01T00:00:00Z",                            â”‚   â”‚
â”‚  â”‚    "date_fin": "2026-02-28T23:59:59Z",                              â”‚   â”‚
â”‚  â”‚    "statut": "ACTIVE",                                               â”‚   â”‚
â”‚  â”‚    "perimetre": {                                                    â”‚   â”‚
â”‚  â”‚      "type": "GEOGRAPHICAL",                                        â”‚   â”‚
â”‚  â”‚      "regions": ["REGION_75", "REGION_92"],                        â”‚   â”‚
â”‚  â”‚      "departements": [75, 92, 93]                                   â”‚   â”‚
â”‚  â”‚    },                                                                â”‚   â”‚
â”‚  â”‚    "justification": "EnquÃªte disparition inquiÃ©tante - dossier X",   â”‚   â”‚
â”‚  â”‚    "reference_judiciaire": "PJ-2026-0234",                          â”‚   â”‚
â”‚  â”‚    "autorisation": {                                                â”‚   â”‚
â”‚  â”‚      "type": "JUGEMENT",                                            â”‚   â”‚   â”‚
â”‚  â”‚      "reference": "TGI Paris 2026-01-15",                          â”‚   â”‚
â”‚  â”‚      "date": "2026-01-15"                                           â”‚   â”‚
â”‚  â”‚    }                                                                 â”‚   â”‚
â”‚  â”‚  }                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  VÃ‰RIFICATION Ã€ CHAQUE REQUÃŠTE                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  SI NOT EXISTS (                                                     â”‚   â”‚
â”‚  â”‚    SELECT 1 FROM missions                                          â”‚   â”‚
â”‚  â”‚    WHERE id = :mission_id                                          â”‚   â”‚
â”‚  â”‚    AND agent_id = :agent_id                                         â”‚   â”‚
â”‚  â”‚    AND statut = 'ACTIVE'                                           â”‚   â”‚
â”‚  â”‚    AND now() BETWEEN date_debut AND date_fin                      â”‚   â”‚
â”‚  â”‚  )                                                                   â”‚   â”‚
â”‚  â”‚  ALORS: REJETER - "Mission inactive ou expirÃ©e"                    â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  SI compte.region NOT IN mission.perimetre.regions                  â”‚   â”‚
â”‚  â”‚  ALORS: REJETER - "Hors pÃ©rimÃ¨tre mission"                         â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Structure JWT

### 7.1 Claims du Token

```json
{
  "header": {
    "alg": "RS256",
    "typ": "JWT",
    "kid": "rnbc-sig-key-2026-v1",
    "x5c": ["MIICXTCCAUUCAQ..."]
  },
  "payload": {
    "iss": "https://idp.rnbc.gouv.fr",
    "sub": "AGENT_4571",
    "name": "Jean DUPONT",
    "org": "GENDARMERIE_NATIONALE",
    "org_code": "GND_075",
    "mission_id": "MIS_2026_0234",
    "mission_type": "ENQUETE_JUDICIAIRE",
    "scope": ["REGION_75", "REGION_92"],
    "perimeter_type": "DEPARTMENTAL",
    "permissions": [
      "account:read:name",
      "account:read:iban",
      "account:read:nir"
    ],
    "not_permissions": [
      "account:export",
      "account:bulk"
    ],
    "iat": 1736687400,
    "exp": 1736691000,
    "jti": "uuid-v4-token-id",
    "amr": ["pwd", "fido2", "hwk"],
    "auth_time": 1736687380,
    "device_fp": "sha256:a1b2c3d4e5f6..."
  },
  "signature": "RSA-SHA256(...)
}
```

---

## 8. Gestion des Sessions

### 8.1 Politique de Session

| ParamÃ¨tre | Valeur | Justification |
|-----------|--------|----------------|
| **DurÃ©e max** | 1 heure | Limiter fenÃªtre d'attaque |
| **Renewal** | Auto avec revalidation | ContinuitÃ© sans faille |
| **Absence** | Timeout 15 min | SÃ©curisÃ© |
| **Single session** | 1 par utilisateur | EmpÃªcher partage |
| **Concurrent alert** | Alerte si double | DÃ©tecter partage |

### 8.2 Cycle de Vie

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CYCLE DE VIE SESSION                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ CRÃ‰ATIONâ”‚â”€â–¶â”‚ ACTIVE  â”‚â”€â–¶â”‚ACTIVE  â”‚â”€â–¶â”‚EXPIRING â”‚â”€â–¶â”‚ EXPIRE  â”‚          â”‚
â”‚  â”‚         â”‚  â”‚         â”‚  â”‚(renewal)â”‚  â”‚         â”‚  â”‚         â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚       â”‚            â”‚            â”‚            â”‚            â”‚                 â”‚
â”‚       â–¼            â–¼            â–¼            â–¼            â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ JWT     â”‚  â”‚ RequÃªte â”‚  â”‚ Revalidâ”‚  â”‚Warning  â”‚  â”‚Token    â”‚          â”‚
â”‚  â”‚Ã©mis     â”‚  â”‚ acceptÃ©eâ”‚  â”‚requiredâ”‚  â”‚envoyÃ©   â”‚  â”‚invalidÃ© â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                             â”‚
â”‚  TIMERS:                                                                    â”‚
â”‚  - Session timeout: 1h                                                       â”‚
â”‚  - Renewal window: 5min avant expiry                                        â”‚
â”‚  - Absolute max: 8h (avec renewal)                                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. Liste de ContrÃ´le ImplÃ©mentation

### 9.1 Checklist DÃ©ploiement

```
â–¡ Composant                  Statut      Date
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â–¡ Keycloak cluster           [ ]         _________
â–¡ Configuration FIDO2         [ ]         _________
â–¡ IntÃ©gration annuaire       [ ]         _________
â–¡ YubiKey deployment         [ ]         _________
â–¡ Device binding workflow    [ ]         _________
â–¡ Context validation         [ ]         _________
â–¡ Mission management         [ ]         _________
â–¡ JWT custom claims          [ ]         _________
â–¡ Session policies           [ ]         _________
â–¡ Integration API Gateway    [ ]         _________
â–¡ Tests intrusion            [ ]         _________
â–¡ Documentation              [ ]         _________
â–¡ Formation utilisateurs     [ ]         _________
â–¡ Go-Live                    [ ]         _________
```

---

*Document SpÃ©cification Identity Layer - Version 1.0*
*Date: 2026-02-23*
